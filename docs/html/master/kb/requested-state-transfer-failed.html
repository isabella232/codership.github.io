<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Resolving Requested State Transfer Failures" name="title" />
<meta content="en-US" name="language" />
<meta content="Codership Oy, 2014 - 2019. All Rights Reserved." name="copyright" />

    <title>Requested State Transfer Failed &#8212; Galera Cluster Documentation</title>
    
    <link rel="stylesheet" href="../_static/reset-style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cluster Stalls on ALTER TABLE" href="stall-on-alter-table.html" />
    <link rel="prev" title="SST Fails with SQL Syntax Errors" href="sst-fails-sql-syntax-error.html" />


<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<link rel="stylesheet" href="/library/_static/basic-style.css">
<link rel="stylesheet" href="/library/_static/header.css">
<link rel="stylesheet" href="/library/_static/footer.css">
<link rel="stylesheet" href="/library/_static/codership.css">

<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Feed" href="https://galeracluster.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Comments Feed" href="https://galeracluster.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Support Comments Feed" href="https://galeracluster.com/support/feed/" />

<script type='text/javascript' src='https://galeracluster.com/wp-includes/js/comment-reply.min.js?ver=3.8.3'></script>

<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://galeracluster.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://galeracluster.com/wp-includes/wlwmanifest.xml" />
<link rel='prev' title='Downloads' href='https://galeracluster.com/downloads/' />
<link rel='next' title='Community' href='https://galeracluster.com/community/' />
<meta name="generator" content="WordPress 3.8.3" />

<link rel='shortlink' href='https://galeracluster.com/?p=12' />

<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css" id="twentythirteen-header-css">
			.site-title,
			.site-description {
				position: absolute;
				clip: rect(1px 1px 1px 1px); /* IE7 */
				clip: rect(1px, 1px, 1px, 1px);
			}
				.site-header .home-link {
				min-height: 0;
			}
</style>

<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-35163478-6']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

</script>

  </head>
  <body role="document">
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>

	<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">

	<div class="top">
	<a class="home-link" href="https://galeracluster.com/" title="Galera Cluster for MySQL" rel="home">
	<h1 class="site-title">Galera Cluster for MySQL</h1>
	<h2 class="site-description">The world&#039;s most advanced open source database cluster</h2>
	</a>
	</div>


	<div id="navbar" class="navbar">
	<nav id="site-navigation" class="navigation main-navigation" role="navigation">
	<div class="menu-main-menu-container">

	<ul id="menu-main-menu" class="nav-menu">
	<li id="menu-item-359" class="link-home menu-item menu-item-type-post_type menu-item-object-page menu-item-359"><a href="https://galeracluster.com/">Home</a></li>
	<li id="menu-item-35" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-35"><a href="https://galeracluster.com/products/">Products</a></li>
	<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-34"><a href="https://galeracluster.com/downloads/">Downloads</a></li>
	<li id="menu-item-33" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-12 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-33"><a href="https://galeracluster.com/support/">Support</a></li>
	<li id="menu-item-32" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-32"><a href="https://galeracluster.com/community/">Community</a></li>
	<li id="menu-item-31" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31"><a href="https://galeracluster.com/company/">Company</a></li>
	<li id="menu-item-297" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-297"><a href="https://galeracluster.com/category/blog/">Blog</a></li>
	<li id="menu-item-38" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38"><a href="https://galeracluster.com/contact-us/">Contact us</a></li>
	</ul>
	</div>


	</nav><!-- #site-navigation -->

	</div><!-- #navbar -->
	</header><!-- #masthead -->


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="left-margin container">
<div class="left-margin-top container">
<a class="reference internal" href="../index.html"><span class="doc">The Library</span></a></div>
<div class="left-margin-content container">
<ul class="simple">
<li><a class="reference internal" href="../documentation/index.html"><span class="doc">Documentation</span></a></li>
</ul>
<ul class="here simple">
<li><a class="reference internal" href="index.html"><span class="doc">Knowledge Base</span></a></li>
</ul>
<ul class="simple">
<li><a class="reference internal" href="../training/index.html"><span class="doc">Training</span></a></li>
</ul>
<ul class="sub-links simple">
<li><a class="reference internal" href="../training/tutorials/index.html"><span class="doc">Tutorial Articles</span></a></li>
<li><a class="reference internal" href="../training/videos/index.html"><span class="doc">Training Videos</span></a></li>
</ul>
<ul class="simple">
<li><a class="reference internal" href="../faq.html"><span class="doc">FAQ</span></a></li>
</ul>
<p>Related Documents</p>
<ul class="simple">
<li><a class="reference internal" href="../documentation/sst.html"><span class="doc">State Transfers</span></a></li>
<li><a class="reference internal" href="../documentation/firewall-settings.html"><span class="doc">TCP/UDP Ports</span></a></li>
<li><a class="reference internal" href="../documentation/mysql-wsrep-options.html#wsrep-node-name"><span class="std std-ref">wsrep_node_name</span></a></li>
<li><a class="reference internal" href="../documentation/mysql-wsrep-options.html#wsrep-sst-donor"><span class="std std-ref">wsrep_sst_donor</span></a></li>
<li><a class="reference internal" href="../documentation/galera-parameters.html#gmcast-segment"><span class="std std-ref">gmcast.segment</span></a></li>
</ul>
</div>
</div>
<div class="library-article section" id="requested-state-transfer-failed">
<span id="kb-trouble-requested-state-transfer-failed"></span><h1>Requested State Transfer Failed<a class="headerlink" href="#requested-state-transfer-failed" title="Permalink to this headline">¶</a></h1>
<p class="article-stats">Length: 649 words; Updated: November 6, 2019; Category: State Transfers; Type: Troubleshooting</p>
<p>When a new node joins a cluster, it will try to synchronize with the cluster by getting a full copy of the databases from one of the other nodes.  This is known as a <a class="reference internal" href="../documentation/sst.html"><span class="doc">State Transfer</span></a>.  It will use a tool like <code class="docutils literal"><span class="pre">rsync</span></code> or <code class="docutils literal"><span class="pre">mysqldump</span></code>, depending on how the <a class="reference internal" href="../documentation/mysql-wsrep-options.html#wsrep-sst-method"><span class="std std-ref">wsrep_sst_method</span></a> option was set. Although this usually works well, sometimes it will fail.  This KB article discusses such a situation.</p>
<p class="section-heading rubric">Scenario</p>
<p>Suppose a new node joins a cluster—this is known as a joiner node.  This is assuming that the node has in fact joined the cluster, but just hasn&#8217;t been able to synchronize the data with the other nodes.  When it joins the cluster, it will look for another node, known as a donor, to give it a copy of the databases by the <a class="reference internal" href="../documentation/glossary.html#term-state-snapshot-transfer"><span class="xref std std-term">State Snapshot Transfer</span></a> (SST) method.  Normally, this starts almost immediately and is completed fairly quickly, depending on the size of the databases and how busy are the nodes.</p>
<p>Suppose further that an excessive amount of time passes without the SST starting. This can be disconcerting. To see what&#8217;s going on, you could check the database server&#8217;s error log, on the joiner node. It may contain a message like this:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Node 0 (XXX) requested state transfer from &#39;*any*&#39;.
Selected 1 (XXX) as donor.
</pre></div>
</div>
<p>This error message indicates that no node was explicitly designated to be the donor node. You may also see this message on the joiner:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Requesting state transfer failed: -11(Resource temporarily
unavailable).  Will keep retrying every 1 second(s).
</pre></div>
</div>
<p>As for the node&#8217;s status, if you execute the <code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">STATUS</span></code> statement, for the <code class="docutils literal"><span class="pre">wsrep_local_state_comment</span></code> variable, you won&#8217;t see the desired <code class="docutils literal"><span class="pre">Synced</span></code> status:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">STATUS</span> <span class="k">LIKE</span> <span class="s1">&#39;wsrep_local_state_comment&#39;</span><span class="p">;</span>

<span class="o">+---------------------------+----------------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>             <span class="o">|</span> <span class="n">Value</span>          <span class="o">|</span>
<span class="o">+---------------------------+----------------+</span>
<span class="o">|</span> <span class="n">wsrep_local_state_comment</span> <span class="o">|</span> <span class="n">Waiting</span> <span class="k">on</span> <span class="n">SST</span> <span class="o">|</span>
<span class="o">+---------------------------+----------------+</span>
</pre></div>
</div>
<p>The joiner node will do its duty and continue to retry the state transfer request.  However, you may need to intercede to resolve the problem, to get the node synchronized for the cluster.</p>
<p class="section-heading rubric">Solution</p>
<p>Behind the scenes, the <em>Group Communication</em> module will select potential donors based on what it knows about the status of each node. These nodes will have to be in a <code class="docutils literal"><span class="pre">SYNCED</span></code> state.  Nodes that have the same <a class="reference internal" href="../documentation/galera-parameters.html#gmcast-segment"><span class="std std-ref">gmcast.segment</span></a> wsrep Provider option are preferred. Otherwise, the joiner will select the first in the list of available synced nodes. If the joiner node can&#8217;t find a free node that shows as <code class="docutils literal"><span class="pre">SYNCED</span></code>, though, state transfer will not occur.</p>
<p>The first step to resolving this problem is to determine if the other nods are in fact not synchronized.  One way to determine which are synchronized is to execute the following SQL statement on each node:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">STATUS</span> <span class="k">LIKE</span> <span class="s1">&#39;wsrep_local_state_comment&#39;</span><span class="p">;</span>

<span class="o">+---------------------------+--------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>             <span class="o">|</span> <span class="n">Value</span>  <span class="o">|</span>
<span class="o">+---------------------------+--------+</span>
<span class="o">|</span> <span class="n">wsrep_local_state_comment</span> <span class="o">|</span> <span class="n">Synced</span> <span class="o">|</span>
<span class="o">+---------------------------+--------+</span>
</pre></div>
</div>
<p>When you find at least one node that is synchronized, get the node name by executing <code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">VARIABLES</span></code> to get the value of <a class="reference internal" href="../documentation/mysql-wsrep-options.html#wsrep-node-name"><span class="std std-ref">wsrep_node_name</span></a> on each synchronized node, like so:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">&#39;wsrep_node_name&#39;</span><span class="p">;</span>

<span class="o">+-----------------+----------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>   <span class="o">|</span> <span class="n">Value</span>    <span class="o">|</span>
<span class="o">+-----------------+----------+</span>
<span class="o">|</span> <span class="n">wsrep_node_name</span> <span class="o">|</span> <span class="n">galera</span><span class="o">-</span><span class="mi">2</span> <span class="o">|</span>
<span class="o">+-----------------+----------+</span>
</pre></div>
</div>
<p>Using those node names—you can designate more than one—to set the donor on the joiner node.  You&#8217;d do this by using the SET statement to set the <a class="reference internal" href="../documentation/mysql-wsrep-options.html#wsrep-sst-donor"><span class="std std-ref">wsrep_sst_donor</span></a> variable to the synchronized node&#8217;s name.  Here&#8217;s an example of how you might do that:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="kt">SET</span> <span class="n">GLOBAL</span> <span class="n">wsrep_sst_donor</span> <span class="o">=</span> <span class="s1">&#39;galera-2,galera-5&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>This informs the cluster that one of the nodes named (i.e., <code class="docutils literal"><span class="pre">galera-2</span></code> and <code class="docutils literal"><span class="pre">galera-5</span></code>) should be used as the donor. You would execute it on one of the synchronized nodes. It will be replicated to all of the nodes. Incidentally, it may be set in the configuration file, but that may not be necessary since the state transfer failing might be a temporary problem.</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">&#39;wsrep_sst_donor&#39;</span><span class="p">;</span>

<span class="o">+-----------------+-------------------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>   <span class="o">|</span> <span class="n">Value</span>             <span class="o">|</span>
<span class="o">+-----------------+-------------------+</span>
<span class="o">|</span> <span class="n">wsrep_sst_donor</span> <span class="o">|</span> <span class="n">galera</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">galera</span><span class="o">-</span><span class="mi">3</span> <span class="o">|</span>
<span class="o">+-----------------+-------------------+</span>
</pre></div>
</div>
<p>Once you&#8217;ve nominated nodes to be donors, assuming the joiner has in fact joined the cluster, initiating state transfer should happen immediately and without any further problem.  If it doesn&#8217;t, confirm that there aren&#8217;t any problems with your network connection. Also, confirm that the needed ports aren&#8217;t being blocked by SELinux or a firewall. In particular, make sure port 4568 is open: it&#8217;s used for State Snapshot Transfers.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">The Codership Knowledge Base</a><ul>
      <li>Previous: <a href="sst-fails-sql-syntax-error.html" title="previous chapter">SST Fails with SQL Syntax Errors</a></li>
      <li>Next: <a href="stall-on-alter-table.html" title="next chapter">Cluster Stalls on <code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code></a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
	<div class="navbar">
	<nav id="site-navigation" class="navigation main-navigation" role="navigation">
	<div class="nav-bar-container">

	<div id="menu-nav-bar" class="nav-menu">
		<ul class="nav-link">
			<li> </li>

		</ul>

	</div>
	</nav>

	<footer id="colophon" class="site-footer" role="contentinfo">
	<div class="top">	<div class="powered-by"><p>Powered by Galera:</p>
	<p><a href="https://mariadb.com/kb/en/galera/"><img class="alignleft size-full wp-image-237" alt="MariaDB" src="https://galeracluster.com/wp-content/uploads/2013/10/logo-mariadb.png" width="166" height="49" /></a></p>
		</div></div>
	<div class="footer-menu">
	<div class="menu-main-menu-container">
	<ul id="menu-main-menu-1" class="nav-menu">
	<li class="link-home menu-item menu-item-type-post_type menu-item-object-page menu-item-359"><a href="https://galeracluster.com/">Home</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-35"><a href="https://galeracluster.com/products/">Products</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-34"><a href="https://galeracluster.com/downloads/">Downloads</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-12 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-33"><a href="https://galeracluster.com/support/">Support</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-32"><a href="https://galeracluster.com/community/">Community</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31"><a href="https://galeracluster.com/company/">Company</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-297"><a href="https://galeracluster.com/category/blog/">Blog</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38"><a href="https://galeracluster.com/contact-us/">Contact us</a></li>
	</ul></div>			</div><!-- .footer-menu -->


	<div class="footer-bar">
	<p class="copyright">2014 Codership Ltd.</p>
	</div>
	<div class="footnote">
	<h2>Your data is invaluable. We're here to secure it. All of it.</h2>
	</div>
	</footer><!-- #colophon -->




  </body>
</html>