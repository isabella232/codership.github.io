<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="User Changes not Replicating in Galera" name="title" />
<meta content="en-US" name="language" />
<meta content="Codership Oy, 2014 - 2019. All Rights Reserved." name="copyright" />

    <title>User Changes not Replicating &#8212; Galera Cluster Documentation</title>
    
    <link rel="stylesheet" href="../_static/reset-style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AUTO_INCREMENT Increasing by Multiples" href="auto-increment-multiples.html" />
    <link rel="prev" title="Cluster Stalls on ALTER TABLE" href="stall-on-alter-table.html" />


<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<link rel="stylesheet" href="/library/_static/basic-style.css">
<link rel="stylesheet" href="/library/_static/header.css">
<link rel="stylesheet" href="/library/_static/footer.css">
<link rel="stylesheet" href="/library/_static/codership.css">

<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Feed" href="https://galeracluster.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Comments Feed" href="https://galeracluster.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Support Comments Feed" href="https://galeracluster.com/support/feed/" />

<script type='text/javascript' src='https://galeracluster.com/wp-includes/js/comment-reply.min.js?ver=3.8.3'></script>

<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://galeracluster.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://galeracluster.com/wp-includes/wlwmanifest.xml" />
<link rel='prev' title='Downloads' href='https://galeracluster.com/downloads/' />
<link rel='next' title='Community' href='https://galeracluster.com/community/' />
<meta name="generator" content="WordPress 3.8.3" />

<link rel='shortlink' href='https://galeracluster.com/?p=12' />

<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css" id="twentythirteen-header-css">
			.site-title,
			.site-description {
				position: absolute;
				clip: rect(1px 1px 1px 1px); /* IE7 */
				clip: rect(1px, 1px, 1px, 1px);
			}
				.site-header .home-link {
				min-height: 0;
			}
</style>

<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-35163478-6']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

</script>

  </head>
  <body role="document">
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>

	<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">

	<div class="top">
	<a class="home-link" href="https://galeracluster.com/" title="Galera Cluster for MySQL" rel="home">
	<h1 class="site-title">Galera Cluster for MySQL</h1>
	<h2 class="site-description">The world&#039;s most advanced open source database cluster</h2>
	</a>
	</div>


	<div id="navbar" class="navbar">
	<nav id="site-navigation" class="navigation main-navigation" role="navigation">
	<div class="menu-main-menu-container">

	<ul id="menu-main-menu" class="nav-menu">
	<li id="menu-item-359" class="link-home menu-item menu-item-type-post_type menu-item-object-page menu-item-359"><a href="https://galeracluster.com/">Home</a></li>
	<li id="menu-item-35" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-35"><a href="https://galeracluster.com/products/">Products</a></li>
	<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-34"><a href="https://galeracluster.com/downloads/">Downloads</a></li>
	<li id="menu-item-33" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-12 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-33"><a href="https://galeracluster.com/support/">Support</a></li>
	<li id="menu-item-32" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-32"><a href="https://galeracluster.com/community/">Community</a></li>
	<li id="menu-item-31" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31"><a href="https://galeracluster.com/company/">Company</a></li>
	<li id="menu-item-297" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-297"><a href="https://galeracluster.com/category/blog/">Blog</a></li>
	<li id="menu-item-38" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38"><a href="https://galeracluster.com/contact-us/">Contact us</a></li>
	</ul>
	</div>


	</nav><!-- #site-navigation -->

	</div><!-- #navbar -->
	</header><!-- #masthead -->


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="left-margin container">
<div class="left-margin-top container">
<a class="reference internal" href="../index.html"><span class="doc">The Library</span></a></div>
<div class="left-margin-content container">
<ul class="simple">
<li><a class="reference internal" href="../documentation/index.html"><span class="doc">Documentation</span></a></li>
</ul>
<ul class="here simple">
<li><a class="reference internal" href="index.html"><span class="doc">Knowledge Base</span></a></li>
</ul>
<ul class="simple">
<li><a class="reference internal" href="../training/index.html"><span class="doc">Training</span></a></li>
</ul>
<ul class="sub-links simple">
<li><a class="reference internal" href="../training/tutorials/index.html"><span class="doc">Tutorial Articles</span></a></li>
<li><a class="reference internal" href="../training/videos/index.html"><span class="doc">Training Videos</span></a></li>
</ul>
<ul class="simple">
<li><a class="reference internal" href="../faq.html"><span class="doc">FAQ</span></a></li>
</ul>
<p>Related Documents</p>
<ul class="simple">
<li><a class="reference internal" href="../training/tutorials/migration.html"><span class="doc">Migration</span></a></li>
</ul>
</div>
</div>
<div class="library-article section" id="user-changes-not-replicating">
<span id="kb-trouble-user-changes"></span><h1>User Changes not Replicating<a class="headerlink" href="#user-changes-not-replicating" title="Permalink to this headline">¶</a></h1>
<p class="article-stats">Length: 506 words; Updated: September 12, 2019; Category: Schema &amp; SQL; Type: Troubleshooting</p>
<p>When a DBA make changes to data in the mysql database—that&#8217;s the database that contains user names and privileges—if done in a straightforward way (e.g., with an <code class="docutils literal"><span class="pre">UPDATE</span></code> statement), they&#8217;re not replicated to the other nodes in the cluster. This can cause problems for users, as well as frustrate the DBA.</p>
<p class="section-heading rubric">Scenario</p>
<p>Suppose you made some changes to database users, but when you check the other nodes, you find they have not replicated to the cluster. For instance, suppose you want to change the host address from which a user, <em>bob</em> may access the cluster. You log into a node and use the <code class="docutils literal"><span class="pre">UPDATE</span></code> statement to change the <code class="docutils literal"><span class="pre">Host</span></code> column in the <code class="docutils literal"><span class="pre">mysql.user</span></code> table for Bob.</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">mysql</span><span class="p">.</span><span class="n">user</span>
<span class="kt">SET</span> <span class="n">Host</span> <span class="o">=</span> <span class="s1">&#39;12.0.12.34&#39;</span>
<span class="k">WHERE</span> <span class="n">User</span> <span class="o">=</span> <span class="s1">&#39;bob&#39;</span> <span class="k">AND</span> <span class="n">Host</span> <span class="o">=</span> <span class="s1">&#39;12.0.56.78&#39;</span><span class="p">;</span>

<span class="k">FLUSH</span> <span class="n">PRIVILEGES</span><span class="p">;</span>
</pre></div>
</div>
<p>When that&#8217;s finished, you ask Bob to log in from the new host.  He tries to connect to the cluster, but through a different node than the one on which you entered the update. He can&#8217;t log in, even thought his local IP address is <code class="docutils literal"><span class="pre">12.0.56.78</span></code>.  He gets this error message:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="n">Enter</span> <span class="n">password</span><span class="p">:</span>
<span class="n">ERROR</span> <span class="mi">1045</span> <span class="p">(</span><span class="mi">28000</span><span class="p">):</span> <span class="n">Access</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">user</span> <span class="s1">&#39;bob&#39;</span><span class="o">@</span><span class="s1">&#39;12.0.56.78&#39;</span>
<span class="p">(</span><span class="k">using</span> <span class="n">password</span><span class="p">:</span> <span class="n">YES</span><span class="p">)</span>
</pre></div>
</div>
<p>You then tell him to log into the cluster through the same node through which you made the update.  He is then successful. The problem is that the change to the <code class="docutils literal"><span class="pre">user</span></code> table didn&#8217;t replicate to the other nodes.</p>
<p>Galera replicates only InnoDB tables.  Therefore, any tables you create should not use other storage engines.  However, the system tables contained in the <code class="docutils literal"><span class="pre">mysql</span></code> database use the MyISAM storage engine. This includes the <code class="docutils literal"><span class="pre">user</span></code> table.</p>
<p>Since these tables are not replicated, you shouldn&#8217;t change them directly by using SQL statements like <code class="docutils literal"><span class="pre">INSERT</span></code>, <code class="docutils literal"><span class="pre">UPDATE</span></code>, or <code class="docutils literal"><span class="pre">DELETE</span></code>.  Instead, you have to use SQL statements like <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">USER</span></code>, <code class="docutils literal"><span class="pre">RENAME</span> <span class="pre">USER</span></code>, <code class="docutils literal"><span class="pre">DROP</span> <span class="pre">USER</span></code>, and <code class="docutils literal"><span class="pre">GRANT</span></code>. If you have difficulty remembering or are unsure which you may not use, just remember that if you have to execute <code class="docutils literal"><span class="pre">FLUSH</span> <span class="pre">PRIVILEGES</span></code> for the change to take effect, you&#8217;re changing the data directly and it won&#8217;t be replicated.</p>
<p class="section-heading rubric">Solution</p>
<p>While direct modifications to the system tables do not replicate, you may use <abbr title="Data Definition Language">DDL</abbr> statements replicate at the statement level.  Changes made to the system tables in this manner will be made to the entire cluster.</p>
<p>Therefore, to make changes to the <code class="docutils literal"><span class="pre">mysql.user</span></code> table, use statements like  <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">USER</span></code>, <code class="docutils literal"><span class="pre">RENAME</span> <span class="pre">USER</span></code> <code class="docutils literal"><span class="pre">DROP</span> <span class="pre">USER</span></code>. And use the <code class="docutils literal"><span class="pre">GRANT</span></code> statement to set user privileges.  So instead of using the <code class="docutils literal"><span class="pre">UPDATE</span></code> statement in the previous example, you should have used the <code class="docutils literal"><span class="pre">RENAME</span> <span class="pre">USER</span></code> statement like so:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="k">RENAME</span> <span class="n">USER</span> <span class="s1">&#39;bob&#39;</span><span class="o">@</span><span class="s1">&#39;127.0.12.34&#39;</span>
<span class="k">TO</span> <span class="s1">&#39;bob&#39;</span><span class="o">@</span><span class="s1">&#39;127.0.56.78&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>This change the host address for the user in a way that will replicate through the cluster.  The user may now access the database from the given IP address through any node in the cluster.</p>
<p>If you have a need to change something directly using a statement such as <code class="docutils literal"><span class="pre">UPDATE</span></code>, to circumvent the usual methods, you must execute the statement on each node, including <code class="docutils literal"><span class="pre">FLUSH</span> <span class="pre">PRIVILEGES</span></code>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">The Codership Knowledge Base</a><ul>
      <li>Previous: <a href="stall-on-alter-table.html" title="previous chapter">Cluster Stalls on <code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code></a></li>
      <li>Next: <a href="auto-increment-multiples.html" title="next chapter">AUTO_INCREMENT Increasing by Multiples</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
	<div class="navbar">
	<nav id="site-navigation" class="navigation main-navigation" role="navigation">
	<div class="nav-bar-container">

	<div id="menu-nav-bar" class="nav-menu">
		<ul class="nav-link">
			<li> </li>

		</ul>

	</div>
	</nav>

	<footer id="colophon" class="site-footer" role="contentinfo">
	<div class="top">	<div class="powered-by"><p>Powered by Galera:</p>
	<p><a href="https://mariadb.com/kb/en/galera/"><img class="alignleft size-full wp-image-237" alt="MariaDB" src="https://galeracluster.com/wp-content/uploads/2013/10/logo-mariadb.png" width="166" height="49" /></a></p>
		</div></div>
	<div class="footer-menu">
	<div class="menu-main-menu-container">
	<ul id="menu-main-menu-1" class="nav-menu">
	<li class="link-home menu-item menu-item-type-post_type menu-item-object-page menu-item-359"><a href="https://galeracluster.com/">Home</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-35"><a href="https://galeracluster.com/products/">Products</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-34"><a href="https://galeracluster.com/downloads/">Downloads</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-12 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-33"><a href="https://galeracluster.com/support/">Support</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-32"><a href="https://galeracluster.com/community/">Community</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31"><a href="https://galeracluster.com/company/">Company</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-297"><a href="https://galeracluster.com/category/blog/">Blog</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38"><a href="https://galeracluster.com/contact-us/">Contact us</a></li>
	</ul></div>			</div><!-- .footer-menu -->


	<div class="footer-bar">
	<p class="copyright">2014 Codership Ltd.</p>
	</div>
	<div class="footnote">
	<h2>Your data is invaluable. We're here to secure it. All of it.</h2>
	</div>
	</footer><!-- #colophon -->




  </body>
</html>