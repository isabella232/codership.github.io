<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Testing a Galera Cluster" name="title" />
<meta content="en-US" name="language" />
<meta content="Codership Oy, 2014 - 2019. All Rights Reserved." name="copyright" />

    <title>Testing a Cluster &#8212; Galera Cluster Documentation</title>
    
    <link rel="stylesheet" href="../../_static/reset-style.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Restarting the Cluster" href="restarting-cluster.html" />
    <link rel="prev" title="Starting the Cluster" href="starting-cluster.html" />


<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<link rel="stylesheet" href="/library/_static/basic-style.css">
<link rel="stylesheet" href="/library/_static/header.css">
<link rel="stylesheet" href="/library/_static/footer.css">
<link rel="stylesheet" href="/library/_static/codership.css">

<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Feed" href="https://galeracluster.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Comments Feed" href="https://galeracluster.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Galera Cluster for MySQL &raquo; Support Comments Feed" href="https://galeracluster.com/support/feed/" />

<script type='text/javascript' src='https://galeracluster.com/wp-includes/js/comment-reply.min.js?ver=3.8.3'></script>

<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://galeracluster.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://galeracluster.com/wp-includes/wlwmanifest.xml" />
<link rel='prev' title='Downloads' href='https://galeracluster.com/downloads/' />
<link rel='next' title='Community' href='https://galeracluster.com/community/' />
<meta name="generator" content="WordPress 3.8.3" />

<link rel='shortlink' href='https://galeracluster.com/?p=12' />

<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css" id="twentythirteen-header-css">
			.site-title,
			.site-description {
				position: absolute;
				clip: rect(1px 1px 1px 1px); /* IE7 */
				clip: rect(1px, 1px, 1px, 1px);
			}
				.site-header .home-link {
				min-height: 0;
			}
</style>

<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-35163478-6']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

</script>

  </head>
  <body role="document">
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>

	<div id="page" class="hfeed site">

	<header id="masthead" class="site-header" role="banner">

	<div class="top">
	<a class="home-link" href="https://galeracluster.com/" title="Galera Cluster for MySQL" rel="home">
	<h1 class="site-title">Galera Cluster for MySQL</h1>
	<h2 class="site-description">The world&#039;s most advanced open source database cluster</h2>
	</a>
	</div>


	<div id="navbar" class="navbar">
	<nav id="site-navigation" class="navigation main-navigation" role="navigation">
	<div class="menu-main-menu-container">

	<ul id="menu-main-menu" class="nav-menu">
	<li id="menu-item-359" class="link-home menu-item menu-item-type-post_type menu-item-object-page menu-item-359"><a href="https://galeracluster.com/">Home</a></li>
	<li id="menu-item-35" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-35"><a href="https://galeracluster.com/products/">Products</a></li>
	<li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-34"><a href="https://galeracluster.com/downloads/">Downloads</a></li>
	<li id="menu-item-33" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-12 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-33"><a href="https://galeracluster.com/support/">Support</a></li>
	<li id="menu-item-32" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-32"><a href="https://galeracluster.com/community/">Community</a></li>
	<li id="menu-item-31" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31"><a href="https://galeracluster.com/company/">Company</a></li>
	<li id="menu-item-297" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-297"><a href="https://galeracluster.com/category/blog/">Blog</a></li>
	<li id="menu-item-38" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38"><a href="https://galeracluster.com/contact-us/">Contact us</a></li>
	</ul>
	</div>


	</nav><!-- #site-navigation -->

	</div><!-- #navbar -->
	</header><!-- #masthead -->


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="left-margin container">
<div class="left-margin-top container">
<a class="reference internal" href="../../index.html"><span class="doc">The Library</span></a></div>
<div class="left-margin-content container">
<ul>
<li><p class="first"><a class="reference internal" href="../../documentation/index.html"><span class="doc">Documentation</span></a></p>
</li>
<li><p class="first"><a class="reference internal" href="../../kb/index.html"><span class="doc">Knowledge Base</span></a></p>
<ul class="sub-links simple">
<li><a class="reference internal" href="../../kb/trouble/index.html"><span class="doc">Troubleshooting</span></a></li>
<li><a class="reference internal" href="../../kb/best/index.html"><span class="doc">Best Practices</span></a></li>
</ul>
<ul class="simple">
<li><a class="reference internal" href="../index.html"><span class="doc">Training</span></a></li>
</ul>
<ul class="sub-links here simple">
<li><a class="reference internal" href="index.html"><span class="doc">Tutorial Articles</span></a></li>
</ul>
<ul class="sub-links simple">
<li><a class="reference internal" href="../videos/index.html"><span class="doc">Training Videos</span></a></li>
</ul>
<p>Related Documents</p>
<ul class="simple">
<li><a class="reference internal" href="../../documentation/galera-status-variables.html#wsrep-local-state-comment"><span class="std std-ref">wsrep_local_state_comment</span></a></li>
<li><a class="reference internal" href="../../documentation/galera-status-variables.html#wsrep-cluster-size"><span class="std std-ref">wsrep_cluster_size</span></a></li>
<li><a class="reference internal" href="../../documentation/galera-status-variables.html#wsrep-ready"><span class="std std-ref">wsrep_ready</span></a></li>
</ul>
<p>Related Articles</p>
</li>
</ul>
</div>
</div>
<div class="library-article section" id="testing-a-cluster">
<span id="testing-cluster"></span><h1>Testing a Cluster<a class="headerlink" href="#testing-a-cluster" title="Permalink to this headline">Â¶</a></h1>
<p class="list-stats">Length:  499 words; Published: October 20, 2014; Topic: General; Level: Beginner</p>
<p>When you have a cluster running, you may want to test certain features to ensure that they are working properly or to prepare yourself for handling actual problems that may arise.</p>
<p class="section-heading rubric" id="replication-testing">Replication Testing</p>
<p>There are a few step to do to test that Galera Cluster is working as expected.  First, using the database client, verify that all nodes have connected to each other.  To do this, execute the <code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">STATUS</span></code> statement like so:</p>
<blockquote>
<div><div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">STATUS</span> <span class="k">LIKE</span> <span class="s1">&#39;wsrep_%&#39;</span><span class="p">;</span>

<span class="o">+---------------------------+------------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>             <span class="o">|</span> <span class="n">Value</span>      <span class="o">|</span>
<span class="o">+---------------------------+------------+</span>
<span class="p">...</span>
<span class="o">|</span> <span class="n">wsrep_local_state_comment</span> <span class="o">|</span> <span class="nf">Synced</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">wsrep_cluster_size</span>        <span class="o">|</span> <span class="mi">3</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">wsrep_ready</span>               <span class="o">|</span> <span class="k">ON</span>         <span class="o">|</span>
<span class="o">+---------------------------+------------+</span>
</pre></div>
</div>
</div></blockquote>
<p>Because of the <code class="docutils literal"><span class="pre">LIKE</span></code> operator, only variables beginning with <code class="docutils literal"><span class="pre">wsrep_</span></code> are returned.  The three variables pertinent here are the ones shown in the example above.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../../documentation/galera-status-variables.html#wsrep-local-state-comment"><span class="std std-ref">wsrep_local_state_comment</span></a>: The value <code class="docutils literal"><span class="pre">Synced</span></code> indicates that the node is connected to the cluster and operational.</li>
<li><a class="reference internal" href="../../documentation/galera-status-variables.html#wsrep-cluster-size"><span class="std std-ref">wsrep_cluster_size</span></a>: The numeric value returned indicates the number of nodes in the cluster.</li>
<li><a class="reference internal" href="../../documentation/galera-status-variables.html#wsrep-ready"><span class="std std-ref">wsrep_ready</span></a>: A value of <code class="docutils literal"><span class="pre">ON</span></code> indicates that this node in which the SQL statement was executed is connected to the cluster and able to handle transactions.</li>
</ul>
</div></blockquote>
<p>For the next test, try creating a table and inserting data into it. Use a database client on <code class="docutils literal"><span class="pre">node1</span></code> to enter these SQL statements:</p>
<blockquote>
<div><div class="highlight-mysql"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>CREATE DATABASE galeratest;</p>
<p>USE galeratest;</p>
<dl class="docutils">
<dt>CREATE TABLE test_table (</dt>
<dd><dl class="first last docutils">
<dt>id INT PRIMARY KEY AUTO_INCREMENT,</dt>
<dd>msg TEXT ) ENGINE=InnoDB;</dd>
</dl>
</dd>
<dt>INSERT INTO test_table (msg)</dt>
<dd>VALUES (&#8220;Hello my dear cluster.&#8221;);</dd>
<dt>INSERT INTO test_table (msg)</dt>
<dd>VALUES (&#8220;Hello, again, cluster dear.&#8221;);</dd>
</dl>
</div></blockquote>
<p>These statements will create the database <code class="docutils literal"><span class="pre">galeratest</span></code> and the table <code class="docutils literal"><span class="pre">test_table</span></code> within it.  The last two SQL statements inserts data into that table.  After doing this, log into <code class="docutils literal"><span class="pre">node2</span></code> and check that the data was replicated correctly.  You would do this with by executing the following SQL statement on <code class="docutils literal"><span class="pre">node2</span></code>:</p>
<blockquote>
<div><div class="highlight-mysql"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>SELECT * FROM galeratest.test_table;</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>id</td>
<td>msg</td>
</tr>
<tr class="row-even"><td>1
2</td>
<td>Hello my dear cluster.
Hello, again, cluster dear.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The results returned  from the <code class="docutils literal"><span class="pre">SELECT</span></code> statement indicates that the data entered on <code class="docutils literal"><span class="pre">node1</span></code> was replicated on <code class="docutils literal"><span class="pre">node2</span></code>.</p>
<p class="section-heading rubric" id="split-brain-testing">Split-Brain Testing</p>
<p>There are a few steps to test Galera Cluster for split-brain situations on a two-node cluster.  First, disconnect the network connection between the two nodes. At this point, the quorum will be lost and the nodes won&#8217;t serve requests.</p>
<p>Now, reconnect the network connection.  The quorum will remain lost and the nodes still won&#8217;t serve requests.</p>
<p>To reset the quorum, on one of the database clients, execute the following SQL statement:</p>
<blockquote>
<div><div class="highlight-mysql"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>SET GLOBAL wsrep_provider_options=&#8217;pc.bootstrap=1&#8217;;</p>
</div></blockquote>
<p>At this point the quorum should be reset and the cluster recovered.</p>
<p class="section-heading rubric" id="failure-simulation">Failure Simulation</p>
<p>You can also test Galera Cluster by simulating various failure situations on three nodes.  To simulate a crash of a single <code class="docutils literal"><span class="pre">mysqld</span></code> process, execute the following from the command-line on one of the nodes:</p>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> killall -9 mysqld
</pre></div>
</div>
</div></blockquote>
<p>To simulate a network disconnection, use <code class="docutils literal"><span class="pre">iptables</span></code> or <code class="docutils literal"><span class="pre">netem</span></code> to block all TCP/IP traffic to a node.</p>
<p>To simulate an entire server crash, run each <code class="docutils literal"><span class="pre">mysqld</span></code> in a virtualized guest, and abrubtly terminate the entire virtual instance.</p>
<p>If you have three or more Galera Cluster nodes, the cluster should be able to survive the simulations.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Codership Training</a><ul>
  <li><a href="index.html">Codership Tutorials on Galera Cluster</a><ul>
  <li><a href="getting-started.html">Getting Started with Galera Cluster</a><ul>
      <li>Previous: <a href="starting-cluster.html" title="previous chapter">Starting the Cluster</a></li>
      <li>Next: <a href="restarting-cluster.html" title="next chapter">Restarting the Cluster</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
	<div class="navbar">
	<nav id="site-navigation" class="navigation main-navigation" role="navigation">
	<div class="nav-bar-container">

	<div id="menu-nav-bar" class="nav-menu">
		<ul class="nav-link">
			<li> </li>

		</ul>

	</div>
	</nav>

	<footer id="colophon" class="site-footer" role="contentinfo">
	<div class="top">	<div class="powered-by"><p>Powered by Galera:</p>
	<p><a href="https://mariadb.com/kb/en/galera/"><img class="alignleft size-full wp-image-237" alt="MariaDB" src="https://galeracluster.com/wp-content/uploads/2013/10/logo-mariadb.png" width="166" height="49" /></a></p>
		</div></div>
	<div class="footer-menu">
	<div class="menu-main-menu-container">
	<ul id="menu-main-menu-1" class="nav-menu">
	<li class="link-home menu-item menu-item-type-post_type menu-item-object-page menu-item-359"><a href="https://galeracluster.com/">Home</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-35"><a href="https://galeracluster.com/products/">Products</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-34"><a href="https://galeracluster.com/downloads/">Downloads</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-12 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-33"><a href="https://galeracluster.com/support/">Support</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-32"><a href="https://galeracluster.com/community/">Community</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31"><a href="https://galeracluster.com/company/">Company</a></li>
	<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-297"><a href="https://galeracluster.com/category/blog/">Blog</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38"><a href="https://galeracluster.com/contact-us/">Contact us</a></li>
	</ul></div>			</div><!-- .footer-menu -->


	<div class="footer-bar">
	<p class="copyright">2014 Codership Ltd.</p>
	</div>
	<div class="footnote">
	<h2>Your data is invaluable. We're here to secure it. All of it.</h2>
	</div>
	</footer><!-- #colophon -->




  </body>
</html>